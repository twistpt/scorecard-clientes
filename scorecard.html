<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📊 Scorecard de Clientes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            border: none;
            background: transparent;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .cliente-card {
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .cliente-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .cliente-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .cliente-nome {
            font-size: 1.4rem;
            font-weight: bold;
            flex: 1;
        }

        .score-badge {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .score-excelente {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .score-bom {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        .score-atencao {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .criterios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .criterio-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .criterio-card:hover {
            border-color: #667eea;
        }

        .criterio-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 10px;
        }

        .criterio-nome {
            font-weight: 600;
            font-size: 0.95rem;
            flex: 1;
        }

        .badge-tipo {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            white-space: nowrap;
        }

        .tipo-escala { background: #e3f2fd; color: #1565c0; }
        .tipo-inverso { background: #fff3e0; color: #ef6c00; }
        .tipo-meta { background: #e8f5e8; color: #2e7d32; }
        .tipo-binario { background: #f3e5f5; color: #7b1fa2; }

        .input-container {
            margin-bottom: 10px;
        }

        /* Inputs de escala */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #dee2e6;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .score-input {
            width: 60px;
            padding: 8px;
            text-align: center;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* Inputs de meta */
        .meta-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            align-items: end;
        }

        .meta-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .meta-input label {
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }

        .meta-input input {
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }

        .meta-resultado {
            background: #667eea;
            color: white;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* Inputs binários */
        .binario-container {
            display: flex;
            gap: 10px;
        }

        .binario-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .binario-btn.sim {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .binario-btn.nao {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }

        .binario-btn:hover {
            transform: translateY(-2px);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .add-form {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .add-form input, .add-form select {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 1rem;
        }

        .ranking {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .ranking-card {
            padding: 25px;
            border-radius: 15px;
            color: white;
        }

        .ranking-top {
            background: linear-gradient(135deg, #00b894, #00a085);
        }

        .ranking-bottom {
            background: linear-gradient(135deg, #e17055, #d63031);
        }

        .ranking-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .criterios-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .criterios-table th,
        .criterios-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .criterios-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .export-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .peso-info {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .criterios-grid {
                grid-template-columns: 1fr;
            }
            .meta-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <h1>📊 Scorecard de Clientes</h1>
                <p>Avaliação mensal do desempenho e satisfação</p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('painel')">📈 Painel</button>
                <button class="tab" onclick="showTab('clientes')">👥 Clientes</button>
                <button class="tab" onclick="showTab('criterios')">⚙️ Critérios</button>
            </div>

            <!-- Tab: Painel -->
            <div id="painel" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-clientes">0</div>
                        <div class="stat-label">👥 Total Clientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="media-geral">0.0</div>
                        <div class="stat-label">📊 Média Geral</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="clientes-excelentes">0</div>
                        <div class="stat-label">🌟 Excelentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-criterios">9</div>
                        <div class="stat-label">⚙️ Critérios</div>
                    </div>
                </div>

                <div class="ranking">
                    <div class="ranking-card ranking-top">
                        <h3>🏆 Top Performers</h3>
                        <div id="top-ranking"></div>
                    </div>
                    <div class="ranking-card ranking-bottom">
                        <h3>⚠️ Precisam de Atenção</h3>
                        <div id="bottom-ranking"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>📋 Resumo Geral</h3>
                    <div id="resumo-table"></div>
                </div>
            </div>

            <!-- Tab: Clientes -->
            <div id="clientes" class="tab-content">
                <div class="add-form">
                    <h3>➕ Adicionar Novo Cliente</h3>
                    <input type="text" id="novo-cliente" placeholder="Ex: 🏢 Nome do Cliente">
                    <button class="btn btn-primary" onclick="adicionarCliente()">Adicionar Cliente</button>
                </div>
                <div id="lista-clientes"></div>
            </div>

            <!-- Tab: Critérios -->
            <div id="criterios" class="tab-content">
                <div class="card">
                    <h3>⚙️ Critérios de Avaliação</h3>
                    <table class="criterios-table">
                        <thead>
                            <tr>
                                <th>Critério</th>
                                <th>Tipo</th>
                                <th>Peso</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="criterios-table-body"></tbody>
                    </table>
                </div>

                <div class="add-form">
                    <h3>➕ Adicionar Critério</h3>
                    <input type="text" id="novo-criterio-nome" placeholder="Ex: 🤝 Relação com a equipa">
                    <select id="novo-criterio-tipo">
                        <option value="escala">📊 Escala 0-10 (Normal)</option>
                        <option value="inverso">🔄 Escala 0-10 (Inverso - problemas)</option>
                        <option value="meta">🎯 Meta vs Realizado (%)</option>
                        <option value="binario">✅ Sim/Não</option>
                    </select>
                    <input type="number" id="novo-criterio-peso" placeholder="Peso (1-20)" value="8" min="1" max="20">
                    <button class="btn btn-primary" onclick="adicionarCriterio()">Adicionar Critério</button>
                </div>

                <div class="card">
                    <h3>💡 Tipos de Critérios</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="padding: 15px; background: #e3f2fd; border-radius: 10px;">
                            <h4>📊 Escala Normal</h4>
                            <p style="font-size: 0.9rem; margin-top: 5px;">Para qualidade, satisfação, etc. Maior = melhor</p>
                        </div>
                        <div style="padding: 15px; background: #fff3e0; border-radius: 10px;">
                            <h4>🔄 Escala Inversa</h4>
                            <p style="font-size: 0.9rem; margin-top: 5px;">Para problemas, atrasos, etc. Maior = pior</p>
                        </div>
                        <div style="padding: 15px; background: #e8f5e8; border-radius: 10px;">
                            <h4>🎯 Meta vs Realizado</h4>
                            <p style="font-size: 0.9rem; margin-top: 5px;">Ex: 6 posts feitos / 9 contratados = 67%</p>
                        </div>
                        <div style="padding: 15px; background: #f3e5f5; border-radius: 10px;">
                            <h4>✅ Sim/Não</h4>
                            <p style="font-size: 0.9rem; margin-top: 5px;">Para critérios binários. Sim=10, Não=0</p>
                        </div>
                    </div>
                </div>

                <div class="export-section">
                    <h3>💾 Backup & Restauro</h3>
                    <button class="btn btn-primary" onclick="exportarDados()">📤 Exportar Dados</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importarDados(event)">
                    <button class="btn btn-primary" onclick="document.getElementById('import-file').click()">📥 Importar Dados</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados iniciais com novos tipos
        let criteria = [
            { id: "posts", nome: "📱 Quantidade de Posts", peso: 10, tipo: "meta" },
            { id: "stories", nome: "📸 Quantidade de Stories", peso: 8, tipo: "meta" },
            { id: "feed", nome: "🎨 Feed representa o posicionamento", peso: 10, tipo: "escala" },
            { id: "surpresa", nome: "✨ Surpreendemos o Cliente", peso: 10, tipo: "binario" },
            { id: "interacoes", nome: "💬 Interações/Engajamento", peso: 9, tipo: "escala" },
            { id: "satisfacao", nome: "😊 Satisfação Percebida", peso: 10, tipo: "escala" },
            { id: "velocidade", nome: "⚡ Velocidade de Resposta", peso: 6, tipo: "escala" },
            { id: "cliente_ausente", nome: "👻 Cliente ausente", peso: 7, tipo: "inverso" },
            { id: "pontos_pendentes", nome: "📋 Pontos pendentes", peso: 9, tipo: "inverso" },
        ];

        let clientes = [
            { id: "c1", nome: "🏢 Cliente Exemplo A" },
            { id: "c2", nome: "🚀 Cliente Exemplo B" },
            { id: "c3", nome: "💎 Cliente Exemplo C" },
        ];

        let registos = {};
        
        const STORAGE_KEY = "scorecard-dados-v2";

        // Funções de Storage
        function carregarDados() {
            const dados = localStorage.getItem(STORAGE_KEY);
            if (dados) {
                const parsed = JSON.parse(dados);
                criteria = parsed.criteria || criteria;
                clientes = parsed.clientes || clientes;
                registos = parsed.registos || {};
            }
        }

        function salvarDados() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                criteria,
                clientes,
                registos
            }));
        }

        // Funções de cálculo melhoradas
        function calcularScore(clienteId) {
            const mes = getCurrentMonth();
            const clienteRegistos = registos[mes]?.[clienteId] || {};
            
            let somaPonderada = 0;
            let pesoTotal = 0;

            criteria.forEach(criterio => {
                const registro = clienteRegistos[criterio.id];
                let valorFinal = 0;

                if (criterio.tipo === 'escala') {
                    valorFinal = Number(registro?.valor || 0);
                } else if (criterio.tipo === 'inverso') {
                    const valor = Number(registro?.valor || 0);
                    valorFinal = valor > 0 ? (10 - valor + 1) : 10; // Inverte: 1->10, 10->1
                } else if (criterio.tipo === 'meta') {
                    const meta = Number(registro?.meta || 1);
                    const realizado = Number(registro?.realizado || 0);
                    const percentual = meta > 0 ? (realizado / meta) * 100 : 0;
                    valorFinal = Math.min(10, percentual / 10); // 100% = 10 pontos
                } else if (criterio.tipo === 'binario') {
                    valorFinal = registro?.valor === 'sim' ? 10 : 0;
                }

                somaPonderada += valorFinal * criterio.peso;
                pesoTotal += criterio.peso;
            });

            return pesoTotal > 0 ? Number((somaPonderada / pesoTotal).toFixed(2)) : 0;
        }

        function getCurrentMonth() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            return `${year}-${month}`;
        }

        function getScoreClass(score) {
            if (score >= 8.5) return { class: 'score-excelente', label: '🌟 Excelente' };
            if (score >= 6.5) return { class: 'score-bom', label: '⚡ Bom' };
            return { class: 'score-atencao', label: '⚠️ Atenção' };
        }

        function getTipoBadge(tipo) {
            const tipos = {
                'escala': { class: 'tipo-escala', label: '📊 Escala' },
                'inverso': { class: 'tipo-inverso', label: '🔄 Inverso' },
                'meta': { class: 'tipo-meta', label: '🎯 Meta' },
                'binario': { class: 'tipo-binario', label: '✅ Sim/Não' }
            };
            return tipos[tipo] || tipos['escala'];
        }

        // Funções de interface
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'painel') atualizarPainel();
            if (tabName === 'clientes') atualizarListaClientes();
            if (tabName === 'criterios') atualizarCriterios();
        }

        function criarInputCriterio(criterio, clienteId) {
            const mes = getCurrentMonth();
            const registro = registos[mes]?.[clienteId]?.[criterio.id] || {};
            const tipoBadge = getTipoBadge(criterio.tipo);

            let inputHTML = '';

            if (criterio.tipo === 'escala' || criterio.tipo === 'inverso') {
                const valor = registro.valor || 0;
                const explicacao = criterio.tipo === 'inverso' ? 
                    '(Menor = melhor para o score)' : 
                    '(Maior = melhor para o score)';
                inputHTML = `
                    <div class="slider-container">
                        <input type="range" class="slider" min="0" max="10" value="${valor}" 
                               onchange="atualizarRegistro('${clienteId}', '${criterio.id}', 'valor', this.value)">
                        <input type="number" class="score-input" min="0" max="10" value="${valor}"
                               onchange="atualizarRegistro('${clienteId}', '${criterio.id}', 'valor', this.value)">
                    </div>
                    <div class="peso-info">${explicacao}</div>
                `;
            } else if (criterio.tipo === 'meta') {
                const meta = registro.meta || '';
                const realizado = registro.realizado || '';
                const percentual = meta > 0 ? Math.round((realizado / meta) * 100) : 0;
                inputHTML = `
                    <div class="meta-container">
                        <div class="meta-input">
                            <label>Meta</label>
                            <input type="number" value="${meta}" min="0"
                                   onchange="atualizarRegistro('${clienteId}', '${criterio.id}', 'meta', this.value)">
                        </div>
                        <div class="meta-input">
                            <label>Realizado</label>
                            <input type="number" value="${realizado}" min="0"
                                   onchange="atualizarRegistro('${clienteId}', '${criterio.id}', 'realizado', this.value)">
                        </div>
                        <div class="meta-resultado">
                            ${percentual}%
                        </div>
                    </div>
                `;
            } else if (criterio.tipo === 'binario') {
                const valor = registro.valor || 'nao';
                inputHTML = `
                    <div class="binario-container">
                        <button class="binario-btn ${valor === 'sim' ? 'sim' : ''}" 
                                onclick="atualizarRegistro('${clienteId}', '${criterio.id}', 'valor', 'sim')">
                            ✅ SIM
                        </button>
                        <button class="binario-btn ${valor === 'nao' ? 'nao' : ''}" 
                                onclick="atualizarRegistro('${clienteId}', '${criterio.id}', 'valor', 'nao')">
                            ❌ NÃO
                        </button>
                    </div>
                `;
            }

            return `
                <div class="criterio-card">
                    <div class="criterio-header">
                        <div class="criterio-nome">${criterio.nome}</div>
                        <div class="badge-tipo ${tipoBadge.class}">${tipoBadge.label}</div>
                    </div>
                    <div class="input-container">
                        ${inputHTML}
                    </div>
                    <div class="peso-info">Peso: ${criterio.peso}</div>
                </div>
            `;
        }

        function atualizarPainel() {
            // Stats
            const totalClientes = clientes.length;
            const scores = clientes.map(c => calcularScore(c.id));
            const mediaGeral = scores.length > 0 ? (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(2) : 0;
            const excelentes = scores.filter(s => s >= 8.5).length;
            const totalCriterios = criteria.length;

            document.getElementById('total-clientes').textContent = totalClientes;
            document.getElementById('media-geral').textContent = mediaGeral;
            document.getElementById('clientes-excelentes').textContent = excelentes;
            document.getElementById('total-criterios').textContent = totalCriterios;

            // Rankings
            const clientesComScore = clientes.map(c => ({
                ...c,
                score: calcularScore(c.id)
            })).sort((a, b) => b.score - a.score);

            // Top 3
            const topHTML = clientesComScore.slice(0, 3).map((c, index) => {
                const medals = ['🥇', '🥈', '🥉'];
                return `
                    <div class="ranking-item">
                        <div>${medals[index]} ${c.nome}</div>
                        <div style="font-weight: bold;">${c.score}</div>
                    </div>
                `;
            }).join('');
            document.getElementById('top-ranking').innerHTML = topHTML;

            // Bottom 3
            const bottomHTML = clientesComScore.slice(-3).reverse().map(c => `
                <div class="ranking-item">
                    <div>⚠️ ${c.nome}</div>
                    <div style="font-weight: bold;">${c.score}</div>
                </div>
            `).join('');
            document.getElementById('bottom-ranking').innerHTML = bottomHTML;

            // Tabela resumo
            const resumoHTML = `
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 15px; text-align: left;">Cliente</th>
                            <th style="padding: 15px; text-align: left;">Score</th>
                            <th style="padding: 15px; text-align: left;">Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${clientesComScore.map(c => {
                            const scoreInfo = getScoreClass(c.score);
                            return `
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 15px; font-weight: 600;">${c.nome}</td>
                                    <td style="padding: 15px; font-size: 1.2rem; font-weight: bold;">${c.score}</td>
                                    <td style="padding: 15px;">
                                        <span class="score-badge ${scoreInfo.class}">${scoreInfo.label}</span>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('resumo-table').innerHTML = resumoHTML;
        }

        function atualizarListaClientes() {
            const html = clientes.map(cliente => {
                const score = calcularScore(cliente.id);
                const scoreInfo = getScoreClass(score);
                
                const criteriosHTML = criteria.map(criterio => criarInputCriterio(criterio, cliente.id)).join('');

                return `
                    <div class="cliente-card">
                        <div class="cliente-header">
                            <div class="cliente-nome">${cliente.nome}</div>
                            <div class="score-badge ${scoreInfo.class}">Score: ${score}</div>
                            <button class="btn btn-danger" onclick="removerCliente('${cliente.id}')">🗑️</button>
                        </div>
                        <div class="criterios-grid">
                            ${criteriosHTML}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('lista-clientes').innerHTML = html;
        }

        function atualizarCriterios() {
            const html = criteria.map(criterio => {
                const tipoBadge = getTipoBadge(criterio.tipo);
                return `
                    <tr>
                        <td style="font-weight: 600;">${criterio.nome}</td>
                        <td><span class="badge-tipo ${tipoBadge.class}">${tipoBadge.label}</span></td>
                        <td>
                            <input type="number" value="${criterio.peso}" min="1" max="20" 
                                   style="width: 80px; padding: 5px; border: 1px solid #ddd; border-radius: 5px;"
                                   onchange="alterarPeso('${criterio.id}', this.value)">
                        </td>
                        <td>
                            <button class="btn btn-danger" onclick="removerCriterio('${criterio.id}')">🗑️</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('criterios-table-body').innerHTML = html;
        }

        // Funções de ação
        function adicionarCliente() {
            const nome = document.getElementById('novo-cliente').value.trim();
            if (!nome) return;

            const id = 'c' + Date.now();
            clientes.push({ id, nome });
            document.getElementById('novo-cliente').value = '';
            
            salvarDados();
            atualizarListaClientes();
            atualizarPainel();
        }

        function removerCliente(id) {
            if (!confirm('Remover este cliente?')) return;
            clientes = clientes.filter(c => c.id !== id);
            
            // Remover registos
            Object.keys(registos).forEach(mes => {
                if (registos[mes][id]) delete registos[mes][id];
            });
            
            salvarDados();
            atualizarListaClientes();
            atualizarPainel();
        }

        function adicionarCriterio() {
            const nome = document.getElementById('novo-criterio-nome').value.trim();
            const tipo = document.getElementById('novo-criterio-tipo').value;
            const peso = parseInt(document.getElementById('novo-criterio-peso').value) || 8;
            
            if (!nome) return;

            const id = nome.toLowerCase().replace(/[^a-z0-9]/g, '_');
            criteria.push({ id, nome, peso, tipo });
            
            // Limpar form
            document.getElementById('novo-criterio-nome').value = '';
            document.getElementById('novo-criterio-tipo').value = 'escala';
            document.getElementById('novo-criterio-peso').value = '8';
            
            salvarDados();
            atualizarCriterios();
            atualizarListaClientes();
            atualizarPainel();
        }

        function removerCriterio(id) {
            if (!confirm('Remover este critério?')) return;
            criteria = criteria.filter(c => c.id !== id);
            
            salvarDados();
            atualizarCriterios();
            atualizarListaClientes();
            atualizarPainel();
        }

        function alterarPeso(id, novoPeso) {
            const criterio = criteria.find(c => c.id === id);
            if (criterio) {
                criterio.peso = parseInt(novoPeso) || 1;
                salvarDados();
                atualizarPainel();
            }
        }

        function atualizarRegistro(clienteId, criterioId, campo, valor) {
            const mes = getCurrentMonth();
            
            if (!registos[mes]) registos[mes] = {};
            if (!registos[mes][clienteId]) registos[mes][clienteId] = {};
            if (!registos[mes][clienteId][criterioId]) registos[mes][clienteId][criterioId] = {};
            
            registos[mes][clienteId][criterioId][campo] = valor;
            
            salvarDados();
            atualizarListaClientes();
            atualizarPainel();
        }

        function exportarDados() {
            const dados = { criteria, clientes, registos };
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `scorecard_${getCurrentMonth()}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function importarDados(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    if (dados.criteria && dados.clientes && dados.registos) {
                        criteria = dados.criteria;
                        clientes = dados.clientes;
                        registos = dados.registos;
                        salvarDados();
                        atualizarPainel();
                        atualizarListaClientes();
                        atualizarCriterios();
                        alert('Dados importados com sucesso!');
                    } else {
                        alert('Ficheiro inválido!');
                    }
                } catch (error) {
                    alert('Erro ao ler ficheiro!');
                }
            };
            reader.readAsText(file);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            atualizarPainel();
            atualizarListaClientes();
            atualizarCriterios();
        });

        // Enter para adicionar
        document.getElementById('novo-cliente').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') adicionarCliente();
        });

        document.getElementById('novo-criterio-nome').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') adicionarCriterio();
        });
    </script>
</body>
</html>
