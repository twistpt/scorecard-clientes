<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Scorecard de Clientes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            text-align: center;
            border: none;
            background: transparent;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .cliente-card {
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .cliente-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .cliente-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .cliente-nome {
            font-size: 1.4rem;
            font-weight: bold;
            flex: 1;
        }

        .score-badge {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .score-excelente {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .score-bom {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        .score-atencao {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .criterios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .criterio-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .criterio-card:hover {
            border-color: #667eea;
        }

        .criterio-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 10px;
        }

        .criterio-nome {
            font-weight: 600;
            font-size: 0.95rem;
            flex: 1;
        }

        .badge-tipo {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            white-space: nowrap;
        }

        .tipo-escala { background: #e3f2fd; color: #1565c0; }
        .tipo-inverso { background: #fff3e0; color: #ef6c00; }
        .tipo-meta { background: #e8f5e8; color: #2e7d32; }
        .tipo-binario { background: #f3e5f5; color: #7b1fa2; }

        .input-container {
            margin-bottom: 10px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #dee2e6;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .score-input {
            width: 60px;
            padding: 8px;
            text-align: center;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .meta-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            align-items: end;
        }

        .meta-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .meta-input label {
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }

        .meta-input input {
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }

        .meta-resultado {
            background: #667eea;
            color: white;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .binario-container {
            display: flex;
            gap: 10px;
        }

        .binario-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .binario-btn.sim {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .binario-btn.nao {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }

        .binario-btn:hover {
            transform: translateY(-2px);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .add-form {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .add-form input, .add-form select {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 1rem;
        }

        .ranking {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .ranking-card {
            padding: 25px;
            border-radius: 15px;
            color: white;
        }

        .ranking-top {
            background: linear-gradient(135deg, #00b894, #00a085);
        }

        .ranking-bottom {
            background: linear-gradient(135deg, #e17055, #d63031);
        }

        .ranking-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .criterios-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .criterios-table th,
        .criterios-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .criterios-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .export-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .peso-info {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 5px;
        }

        /* Hist√≥rico Styles */
        .historico-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .historico-controls select, .historico-controls input {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-weight: 600;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            height: 400px;
        }

        .historico-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .meta-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .meta-progress {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .meta-progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s;
        }

        .progress-green { background: #28a745; }
        .progress-yellow { background: #ffc107; }
        .progress-red { background: #dc3545; }

        .delta-up { color: #28a745; font-weight: bold; }
        .delta-down { color: #dc3545; font-weight: bold; }
        .delta-neutral { color: #6c757d; font-weight: bold; }

        .relatorio-section {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .relatorio-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .trend-up { color: #28a745; }
        .trend-down { color: #dc3545; }
        .trend-stable { color: #6c757d; }

        @media (max-width: 768px) {
            .criterios-grid {
                grid-template-columns: 1fr;
            }
            .meta-container {
                grid-template-columns: 1fr;
            }
            .historico-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .tabs {
                flex-direction: column;
            }
            .tab {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <h1>üìä Scorecard de Clientes</h1>
                <p>Avalia√ß√£o mensal do desempenho e satisfa√ß√£o</p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('painel')">üìà Painel</button>
                <button class="tab" onclick="showTab('clientes')">üë• Clientes</button>
                <button class="tab" onclick="showTab('historico')">üìÖ Hist√≥rico</button>
                <button class="tab" onclick="showTab('criterios')">‚öôÔ∏è Crit√©rios</button>
            </div>

            <!-- Tab: Painel -->
            <div id="painel" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-clientes">0</div>
                        <div class="stat-label">üë• Total Clientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="media-geral">0.0</div>
                        <div class="stat-label">üìä M√©dia Geral</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="clientes-excelentes">0</div>
                        <div class="stat-label">üåü Excelentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-criterios">9</div>
                        <div class="stat-label">‚öôÔ∏è Crit√©rios</div>
                    </div>
                </div>

                <div class="ranking">
                    <div class="ranking-card ranking-top">
                        <h3>üèÜ Top Performers</h3>
                        <div id="top-ranking"></div>
                    </div>
                    <div class="ranking-card ranking-bottom">
                        <h3>‚ö†Ô∏è Precisam de Aten√ß√£o</h3>
                        <div id="bottom-ranking"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìã Resumo Geral</h3>
                    <div id="resumo-table"></div>
                </div>
            </div>

            <!-- Tab: Clientes -->
            <div id="clientes" class="tab-content">
                <div class="add-form">
                    <h3>‚ûï Adicionar Novo Cliente</h3>
                    <input type="text" id="novo-cliente" placeholder="Ex: üè¢ Nome do Cliente">
                    <button class="btn btn-primary" onclick="adicionarCliente()">Adicionar Cliente</button>
                </div>
                <div id="lista-clientes"></div>
            </div>

            <!-- Tab: Hist√≥rico -->
            <div id="historico" class="tab-content">
                <!-- Controles -->
                <div class="historico-controls">
                    <label><strong>üìÖ Ano:</strong></label>
                    <select id="ano-selector" onchange="atualizarHistorico()">
                        <option value="2024">2024</option>
                        <option value="2025" selected>2025</option>
                        <option value="2026">2026</option>
                    </select>
                    
                    <label><strong>üóìÔ∏è M√™s:</strong></label>
                    <select id="mes-selector" onchange="atualizarComparacao()">
                        <option value="">Todos os meses</option>
                        <option value="01">Janeiro</option>
                        <option value="02">Fevereiro</option>
                        <option value="03">Mar√ßo</option>
                        <option value="04">Abril</option>
                        <option value="05">Maio</option>
                        <option value="06">Junho</option>
                        <option value="07">Julho</option>
                        <option value="08">Agosto</option>
                        <option value="09">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>

                    <button class="btn btn-primary" onclick="atualizarHistorico()">üîÑ Atualizar</button>
                </div>

                <!-- 1. Evolu√ß√£o Individual -->
                <div class="card">
                    <h3>üìä Evolu√ß√£o Individual dos Clientes</h3>
                    <div class="chart-container">
                        <canvas id="evolucaoChart"></canvas>
                    </div>
                </div>

                <!-- 2. Compara√ß√£o Mensal -->
                <div class="card">
                    <h3>üìà Compara√ß√£o Mensal</h3>
                    <div id="comparacao-mensal"></div>
                </div>

                <!-- 3. Metas Anuais -->
                <div class="card">
                    <h3>üéØ Metas Anuais</h3>
                    <div class="add-form">
                        <h4>Definir Meta para Cliente</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                            <select id="meta-cliente">
                                <option value="">Selecionar Cliente</option>
                            </select>
                            <input type="number" id="meta-score" placeholder="Score Alvo (ex: 8.5)" step="0.1" min="0" max="10">
                            <button class="btn btn-success" onclick="definirMeta()">Definir Meta</button>
                        </div>
                    </div>
                    <div class="historico-grid" id="metas-grid"></div>
                </div>

                <!-- 4. Relat√≥rios Executivos -->
                <div class="relatorio-section">
                    <h3>üìã Relat√≥rios Executivos</h3>
                    <p>Exports e an√°lises para apresenta√ß√µes</p>
                    <div class="relatorio-buttons">
                        <button class="btn btn-success" onclick="exportarRelatorioCompleto()">üìä Relat√≥rio Completo (JSON)</button>
                        <button class="btn btn-success" onclick="exportarCSV()">üìà Dados CSV</button>
                        <button class="btn btn-success" onclick="exportarResumoExecutivo()">üìã Resumo Executivo</button>
                        <button class="btn btn-success" onclick="gerarRelatorioTendencias()">üìâ An√°lise Tend√™ncias</button>
                    </div>
                </div>
            </div>

            <!-- Tab: Crit√©rios -->
            <div id="criterios" class="tab-content">
                <div class="card">
                    <h3>‚öôÔ∏è Crit√©rios de Avalia√ß√£o</h3>
                    <table class="criterios-table">
                        <thead>
                            <tr>
                                <th>Crit√©rio</th>
                                <th>Tipo</th>
                                <th>Peso</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="criterios-table-body"></tbody>
                    </table>
                </div>

                <div class="add-form">
                    <h3>‚ûï Adicionar Crit√©rio</h3>
                    <input type="text" id="novo-criterio-nome" placeholder="Ex: ü§ù Rela√ß√£o com a equipa">
                    <select id="novo-criterio-tipo">
                        <option value="escala">üìä Escala 0-10 (Normal)</option>
                        <option value="inverso">üîÑ Escala 0-10 (Inverso - problemas)</option>
                        <option value="meta">üéØ Meta vs Realizado (%)</option>
                        <option value="binario">‚úÖ Sim/N√£o</option>
                    </select>
                    <input type="number" id="novo-criterio-peso" placeholder="Peso (1-20)" value="8" min="1" max="20">
                    <button class="btn btn-primary" onclick="adicionarCriterio()">Adicionar Crit√©rio</button>
                </div>

                <div class="card">
                    <h3>üí° Tipos de Crit√©rios</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="padding: 15px; background: #e3f2fd; border-radius: 10px;">
                            <h4>üìä Escala Normal</h4>
                            <p style="font-size: 0.9rem; margin-top: 5px;">Para qualidade, satisfa√ß√£o, etc. Maior = melhor</p>
                        </div>
                        <div style="padding: 15px; background: #fff3e0; border-radius: 10px;">
                            <h4>üîÑ Escala Inversa</h4>
                            <p style="font-size: 0.9rem; margin-top: 5px;">Para problemas, atrasos, etc. Maior = pior</p>
                        </div>
                        <div style="padding: 15px; background: #e8f5e8; border-radius: 10px;">
                            <h4>üéØ Meta vs Realizado</h4>
                            <p style="font-size: 0.9rem; margin-top: 5px;">Ex: 6 posts feitos / 9 contratados = 67%</p>
                        </div>
                        <div style="padding: 15px; background: #f3e5f5; border-radius: 10px;">
                            <h4>‚úÖ Sim/N√£o</h4>
                            <p style="font-size: 0.9rem; margin-top: 5px;">Para crit√©rios bin√°rios. Sim=10, N√£o=0</p>
                        </div>
                    </div>
                </div>

                <div class="export-section">
                    <h3>üíæ Backup & Restauro</h3>
                    <button class="btn btn-primary" onclick="exportarDados()">üì§ Exportar Dados</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importarDados(event)">
                    <button class="btn btn-primary" onclick="document.getElementById('import-file').click()">üì• Importar Dados</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados iniciais com novos tipos
        let criteria = [
            { id: "posts", nome: "üì± Quantidade de Posts", peso: 10, tipo: "meta" },
            { id: "stories", nome: "üì∏ Quantidade de Stories", peso: 8, tipo: "meta" },
            { id: "feed", nome: "üé® Feed representa o posicionamento", peso: 10, tipo: "escala" },
            { id: "surpresa", nome: "‚ú® Surpreendemos o Cliente", peso: 10, tipo: "binario" },
            { id: "interacoes", nome: "üí¨ Intera√ß√µes/Engajamento", peso: 9, tipo: "escala" },
            { id: "satisfacao", nome: "üòä Satisfa√ß√£o Percebida", peso: 10, tipo: "escala" },
            { id: "velocidade", nome: "‚ö° Velocidade de Resposta", peso: 6, tipo: "escala" },
            { id: "cliente_ausente", nome: "üëª Cliente ausente", peso: 7, tipo: "inverso" },
            { id: "pontos_pendentes", nome: "üìã Pontos pendentes", peso: 9, tipo: "inverso" },
        ];

        let clientes = [
            { id: "c1", nome: "üè¢ Cliente Exemplo A" },
            { id: "c2", nome: "üöÄ Cliente Exemplo B" },
            { id: "c3", nome: "üíé Cliente Exemplo C" },
        ];

        let registos = {};
        let metas = {}; // { "2025": { "c1": { scoreAlvo: 8.5, obs: "Meta definida" }}}
        
        const STORAGE_KEY = "scorecard-dados-v3";

        // Fun√ß√µes de Storage
        function carregarDados() {
            const dados = localStorage.getItem(STORAGE_KEY);
            if (dados) {
                const parsed = JSON.parse(dados);
                criteria = parsed.criteria || criteria;
                clientes = parsed.clientes || clientes;
                registos = parsed.registos || {};
                metas = parsed.metas || {};
            }
        }

        function salvarDados() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                criteria,
                clientes,
                registos,
                metas
            }));
        }

        // Fun√ß√µes de c√°lculo melhoradas
        function calcularScore(clienteId, mesEspecifico = null) {
            const mes = mesEspecifico || getCurrentMonth();
            const clienteRegistos = registos[mes]?.[clienteId] || {};
            
            let somaPonderada = 0;
            let pesoTotal = 0;

            criteria.forEach(criterio => {
                const registro = clienteRegistos[criterio.id];
                let valorFinal = 0;

                if (criterio.tipo === 'escala') {
                    valorFinal = Number(registro?.valor || 0);
                } else if (criterio.tipo === 'inverso') {
                    const valor = Number(registro?.valor || 0);
                    valorFinal = valor > 0 ? (11 - valor) : 10;
                } else if (criterio.tipo === 'meta') {
                    const meta = Number(registro?.meta || 1);
                    const realizado = Number(registro?.realizado || 0);
                    const percentual = meta > 0 ? (realizado / meta) * 100 : 0;
                    valorFinal = Math.min(10, percentual / 10);
                } else if (criterio.tipo === 'binario') {
                    valorFinal = registro?.valor === 'sim' ? 10 : 0;
                }

                somaPonderada += valorFinal * criterio.peso;
                pesoTotal += criterio.peso;
            });

            return pesoTotal > 0 ? Number((somaPonderada / pesoTotal).toFixed(2)) : 0;
        }

        function getCurrentMonth() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            return `${year}-${month}`;
        }

        function getScoreClass(score) {
            if (score >= 8.5) return { class: 'score-excelente', label: 'üåü Excelente' };
            if (score >= 6.5) return { class: 'score-bom', label: '‚ö° Bom' };
            return { class: 'score-atencao', label: '‚ö†Ô∏è Aten√ß√£o' };
        }

        function getTipoBadge(tipo) {
            const tipos = {
                'escala': { class: 'tipo-escala', label: 'üìä Escala' },
                'inverso': { class: 'tipo-inverso', label: 'üîÑ Inverso' },
                'meta': { class: 'tipo-meta', label: 'üéØ Meta' },
                'binario': { class: 'tipo-binario', label: '‚úÖ Sim/N√£o' }
            };
            return tipos[tipo] || tipos['escala'];
        }

        function getMonthName(monthKey) {
            const months = ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"];
            const [year, month] = monthKey.split("-");
            return `${months[parseInt(month) - 1]} ${year}`;
        }

        // Fun√ß√µes de interface
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'painel') atualizarPainel();
            if (tabName === 'clientes') atualizarListaClientes();
            if (tabName === 'historico') {
                atualizarSeletorMetas();
                atualizarHistorico();
            }
            if (tabName === 'criterios') atualizarCriterios();
        }

        function criarInputCriterio(criterio, clienteId) {
            const mes = getCurrentMonth();
            const registro = registos[mes]?.[clienteId]?.[criterio.id] || {};
            const tipoBadge = getTipoBadge(criterio.tipo);

            let inputHTML = '';

            if (criterio.tipo === 'escala' || criterio.tipo === 'inverso') {
                const valor = registro.valor || 0;
                const explicacao = criterio.tipo === 'inverso' ? 
                    '(Menor = melhor para o score)' : 
                    '(Maior = melhor para o score)';
                inputHTML = `
                    <div class="slider-container">
                        <input type="range" class="slider" min="0" max="10" value="${valor}" 
                               onchange="atualizarRegistro('${clienteId}', '${criterio.id}', 'valor', this.value)">
                        <input type="number" class="score-input" min="0" max="10" value="${valor}"
                               onchange="atualizarRegistro('${clienteId}', '${criterio.id}', 'valor', this.value)">
                    </div>
                    <div class="peso-info">${explicacao}</div>
                `;
            } else if (criterio.tipo === 'meta') {
                const meta = registro.meta || '';
                const realizado = registro.realizado || '';
                const percentual = meta > 0 ? Math.round((realizado / meta) * 100) : 0;
                inputHTML = `
                    <div class="meta-container">
                        <div class="meta-input">
                            <label>Meta</label>
                            <input type="number" value="${meta}" min="0"
                                   onchange="atualizarRegistro('${clienteId}', '${criterio.id}', 'meta', this.value)">
                        </div>
                        <div class="meta-input">
                            <label>Realizado</label>
                            <input type="number" value="${realizado}" min="0"
                                   onchange="atualizarRegistro('${clienteId}', '${criterio.id}', 'realizado', this.value)">
                        </div>
                        <div class="meta-resultado">
                            ${percentual}%
                        </div>
                    </div>
                `;
            } else if (criterio.tipo === 'binario') {
                const valor = registro.valor || 'nao';
                inputHTML = `
                    <div class="binario-container">
                        <button class="binario-btn ${valor === 'sim' ? 'sim' : ''}" 
                                onclick="atualizarRegistro('${clienteId}', '${criterio.id}', 'valor', 'sim')">
                            ‚úÖ SIM
                        </button>
                        <button class="binario-btn ${valor === 'nao' ? 'nao' : ''}" 
                                onclick="atualizarRegistro('${clienteId}', '${criterio.id}', 'valor', 'nao')">
                            ‚ùå N√ÉO
                        </button>
                    </div>
                `;
            }

            return `
                <div class="criterio-card">
                    <div class="criterio-header">
                        <div class="criterio-nome">${criterio.nome}</div>
                        <div class="badge-tipo ${tipoBadge.class}">${tipoBadge.label}</div>
                    </div>
                    <div class="input-container">
                        ${inputHTML}
                    </div>
                    <div class="peso-info">Peso: ${criterio.peso}</div>
                </div>
            `;
        }

        // Fun√ß√µes do Hist√≥rico
        function atualizarHistorico() {
            atualizarGraficoEvolucao();
            atualizarComparacao();
            atualizarMetas();
        }

        function atualizarGraficoEvolucao() {
            const ano = document.getElementById('ano-selector').value;
            const canvas = document.getElementById('evolucaoChart');
            const ctx = canvas.getContext('2d');

            // Gerar meses do ano
            const meses = [];
            for (let i = 1; i <= 12; i++) {
                meses.push(`${ano}-${String(i).padStart(2, '0')}`);
            }

            // Preparar dados por cliente
            const datasets = clientes.map((cliente, index) => {
                const data = meses.map(mes => calcularScore(cliente.id, mes));
                const colors = ['#667eea', '#764ba2', '#28a745', '#dc3545', '#ffc107', '#17a2b8'];
                
                return {
                    label: cliente.nome,
                    data: data,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    tension: 0.4,
                    fill: false
                };
            });

            // Destruir gr√°fico anterior se existir
            if (window.evolucaoChart) {
                window.evolucaoChart.destroy();
            }

            // Criar novo gr√°fico
            window.evolucaoChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: meses.map(mes => getMonthName(mes)),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Evolu√ß√£o dos Scores - ${ano}`
                        },
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'Score'
                            }
                        }
                    }
                }
            });
        }

        function atualizarComparacao() {
            const mesAtual = document.getElementById('mes-selector').value;
            const ano = document.getElementById('ano-selector').value;
            
            if (!mesAtual) {
                document.getElementById('comparacao-mensal').innerHTML = '<p>Selecione um m√™s espec√≠fico para ver a compara√ß√£o.</p>';
                return;
            }

            const mesAtualKey = `${ano}-${mesAtual}`;
            const mesAnterior = getMesAnterior(mesAtualKey);

            let html = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Atual (${getMonthName(mesAtualKey)})</th>
                            <th>Anterior (${getMonthName(mesAnterior)})</th>
                            <th>Diferen√ßa</th>
                            <th>Tend√™ncia</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            clientes.forEach(cliente => {
                const scoreAtual = calcularScore(cliente.id, mesAtualKey);
                const scoreAnterior = calcularScore(cliente.id, mesAnterior);
                const diferenca = (scoreAtual - scoreAnterior).toFixed(2);
                
                let deltaClass = 'delta-neutral';
                let tendencia = '‚û°Ô∏è Est√°vel';
                
                if (diferenca > 0.1) {
                    deltaClass = 'delta-up';
                    tendencia = 'üìà Subindo';
                } else if (diferenca < -0.1) {
                    deltaClass = 'delta-down';
                    tendencia = 'üìâ Descendo';
                }

                html += `
                    <tr>
                        <td><strong>${cliente.nome}</strong></td>
                        <td>${scoreAtual}</td>
                        <td>${scoreAnterior}</td>
                        <td class="${deltaClass}">${diferenca > 0 ? '+' : ''}${diferenca}</td>
                        <td>${tendencia}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            document.getElementById('comparacao-mensal').innerHTML = html;
        }

        function getMesAnterior(mesKey) {
            const [ano, mes] = mesKey.split('-');
            let anoAnterior = parseInt(ano);
            let mesAnterior = parseInt(mes) - 1;
            
            if (mesAnterior === 0) {
                mesAnterior = 12;
                anoAnterior -= 1;
            }
            
            return `${anoAnterior}-${String(mesAnterior).padStart(2, '0')}`;
        }

        function atualizarSeletorMetas() {
            const selector = document.getElementById('meta-cliente');
            selector.innerHTML = '<option value="">Selecionar Cliente</option>';
            
            clientes.forEach(cliente => {
                selector.innerHTML += `<option value="${cliente.id}">${cliente.nome}</option>`;
            });
        }

        function definirMeta() {
            const clienteId = document.getElementById('meta-cliente').value;
            const scoreAlvo = parseFloat(document.getElementById('meta-score').value);
            const ano = document.getElementById('ano-selector').value;
            
            if (!clienteId || !scoreAlvo) {
                alert('Selecione um cliente e defina um score alvo');
                return;
            }
            
            if (!metas[ano]) metas[ano] = {};
            if (!metas[ano][clienteId]) metas[ano][clienteId] = {};
            
            metas[ano][clienteId].scoreAlvo = scoreAlvo;
            metas[ano][clienteId].definidaEm = new Date().toISOString();
            
            document.getElementById('meta-cliente').value = '';
            document.getElementById('meta-score').value = '';
            
            salvarDados();
            atualizarMetas();
        }

        function atualizarMetas() {
            const ano = document.getElementById('ano-selector').value;
            const metasAno = metas[ano] || {};
            
            let html = '';
            
            clientes.forEach(cliente => {
                const meta = metasAno[cliente.id];
                const scoreAtual = calcularScore(cliente.id);
                
                if (meta) {
                    const progresso = Math.min(100, (scoreAtual / meta.scoreAlvo) * 100);
                    let progressClass = 'progress-red';
                    
                    if (progresso >= 90) progressClass = 'progress-green';
                    else if (progresso >= 70) progressClass = 'progress-yellow';
                    
                    html += `
                        <div class="meta-card">
                            <h4>${cliente.nome}</h4>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Atual: <strong>${scoreAtual}</strong></span>
                                <span>Meta: <strong>${meta.scoreAlvo}</strong></span>
                            </div>
                            <div class="meta-progress">
                                <div class="meta-progress-bar ${progressClass}" style="width: ${progresso}%"></div>
                            </div>
                            <div style="text-align: center; margin-top: 10px;">
                                <strong>${Math.round(progresso)}% da meta</strong>
                            </div>
                            <button class="btn btn-danger" style="margin-top: 10px; width: 100%;" 
                                    onclick="removerMeta('${ano}', '${cliente.id}')">Remover Meta</button>
                        </div>
                    `;
                }
            });
            
            if (!html) {
                html = '<p style="text-align: center; color: #666; padding: 40px;">Nenhuma meta definida para este ano. Use o formul√°rio acima para adicionar metas.</p>';
            }
            
            document.getElementById('metas-grid').innerHTML = html;
        }

        function removerMeta(ano, clienteId) {
            if (confirm('Remover meta para este cliente?')) {
                if (metas[ano] && metas[ano][clienteId]) {
                    delete metas[ano][clienteId];
                }
                salvarDados();
                atualizarMetas();
            }
        }

        // Fun√ß√µes de Export/Relat√≥rios
        function exportarRelatorioCompleto() {
            const ano = document.getElementById('ano-selector').value;
            const relatorio = {
                ano: ano,
                geradoEm: new Date().toISOString(),
                clientes: clientes.length,
                criterios: criteria.length,
                dadosCompletos: {
                    clientes: clientes,
                    criteria: criteria,
                    registos: registos,
                    metas: metas
                },
                resumoAnual: {}
            };

            // Calcular resumo por m√™s
            for (let mes = 1; mes <= 12; mes++) {
                const mesKey = `${ano}-${String(mes).padStart(2, '0')}`;
                const scores = clientes.map(c => calcularScore(c.id, mesKey));
                const media = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
                
                relatorio.resumoAnual[mesKey] = {
                    media: Number(media.toFixed(2)),
                    excelentes: scores.filter(s => s >= 8.5).length,
                    atencao: scores.filter(s => s < 6.5).length
                };
            }

            const blob = new Blob([JSON.stringify(relatorio, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `relatorio_completo_${ano}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportarCSV() {
            const ano = document.getElementById('ano-selector').value;
            let csv = 'Cliente,M√™s,Score,Estado\n';
            
            clientes.forEach(cliente => {
                for (let mes = 1; mes <= 12; mes++) {
                    const mesKey = `${ano}-${String(mes).padStart(2, '0')}`;
                    const score = calcularScore(cliente.id, mesKey);
                    const estado = getScoreClass(score).label.replace('üåü ', '').replace('‚ö° ', '').replace('‚ö†Ô∏è ', '');
                    
                    csv += `"${cliente.nome}","${getMonthName(mesKey)}",${score},"${estado}"\n`;
                }
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dados_${ano}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportarResumoExecutivo() {
            const ano = document.getElementById('ano-selector').value;
            const mesAtual = getCurrentMonth();
            
            const resumo = {
                titulo: `Resumo Executivo - ${ano}`,
                geradoEm: new Date().toLocaleDateString('pt-PT'),
                kpis: {
                    totalClientes: clientes.length,
                    mediaGeral: calcularMediaGeral(),
                    clientesExcelentes: contarClientesPorEstado('excelente'),
                    clientesAtencao: contarClientesPorEstado('atencao')
                },
                topPerformers: obterTopPerformers(3),
                bottomPerformers: obterBottomPerformers(3),
                tendencias: calcularTendencias(),
                recomendacoes: gerarRecomendacoes()
            };

            const blob = new Blob([JSON.stringify(resumo, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `resumo_executivo_${ano}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function gerarRelatorioTendencias() {
            const ano = document.getElementById('ano-selector').value;
            const tendencias = {
                titulo: `An√°lise de Tend√™ncias - ${ano}`,
                analise: {},
                alertas: [],
                oportunidades: []
            };

            clientes.forEach(cliente => {
                const scores = [];
                for (let mes = 1; mes <= 12; mes++) {
                    const mesKey = `${ano}-${String(mes).padStart(2, '0')}`;
                    scores.push(calcularScore(cliente.id, mesKey));
                }

                const tendencia = calcularTendenciaCliente(scores);
                tendencias.analise[cliente.id] = {
                    nome: cliente.nome,
                    tendencia: tendencia,
                    scoreMinimo: Math.min(...scores),
                    scoreMaximo: Math.max(...scores),
                    scoreAtual: scores[scores.length - 1]
                };

                // Gerar alertas
                if (tendencia === 'decrescente') {
                    tendencias.alertas.push(`‚ö†Ô∏è ${cliente.nome}: Tend√™ncia de queda no score`);
                }

                if (tendencia === 'crescente') {
                    tendencias.oportunidades.push(`üìà ${cliente.nome}: Melhoria consistente`);
                }
            });

            const blob = new Blob([JSON.stringify(tendencias, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analise_tendencias_${ano}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Fun√ß√µes auxiliares
        function calcularMediaGeral() {
            const scores = clientes.map(c => calcularScore(c.id));
            return scores.length > 0 ? Number((scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(2)) : 0;
        }

        function contarClientesPorEstado(estado) {
            return clientes.filter(c => {
                const score = calcularScore(c.id);
                if (estado === 'excelente') return score >= 8.5;
                if (estado === 'atencao') return score < 6.5;
                return score >= 6.5 && score < 8.5;
            }).length;
        }

        function obterTopPerformers(n) {
            return clientes.map(c => ({
                nome: c.nome,
                score: calcularScore(c.id)
            })).sort((a, b) => b.score - a.score).slice(0, n);
        }

        function obterBottomPerformers(n) {
            return clientes.map(c => ({
                nome: c.nome,
                score: calcularScore(c.id)
            })).sort((a, b) => a.score - b.score).slice(0, n);
        }

        function calcularTendencias() {
            const mesAtual = getCurrentMonth();
            const mesAnterior = getMesAnterior(mesAtual);
            
            let subindo = 0, descendo = 0, estavel = 0;
            
            clientes.forEach(c => {
                const atual = calcularScore(c.id, mesAtual);
                const anterior = calcularScore(c.id, mesAnterior);
                const diff = atual - anterior;
                
                if (diff > 0.1) subindo++;
                else if (diff < -0.1) descendo++;
                else estavel++;
            });
            
            return { subindo, descendo, estavel };
        }

        function calcularTendenciaCliente(scores) {
            if (scores.length < 2) return 'insuficiente';
            
            const primeirosQuatro = scores.slice(0, 4);
            const ultimosQuatro = scores.slice(-4);
            
            const mediaPrimeiros = primeirosQuatro.reduce((a, b) => a + b, 0) / primeirosQuatro.length;
            const mediaUltimos = ultimosQuatro.reduce((a, b) => a + b, 0) / ultimosQuatro.length;
            
            const diferenca = mediaUltimos - mediaPrimeiros;
            
            if (diferenca > 0.5) return 'crescente';
            if (diferenca < -0.5) return 'decrescente';
            return 'est√°vel';
        }

        function gerarRecomendacoes() {
            const recomendacoes = [];
            const mediaGeral = calcularMediaGeral();
            
            if (mediaGeral < 7) {
                recomendacoes.push("üìä M√©dia geral baixa. Revisar estrat√©gias de atendimento.");
            }
            
            const clientesAtencao = contarClientesPorEstado('atencao');
            if (clientesAtencao > 0) {
                recomendacoes.push(`‚ö†Ô∏è ${clientesAtencao} cliente(s) precisam de aten√ß√£o imediata.`);
            }
            
            if (recomendacoes.length === 0) {
                recomendacoes.push("üåü Performance geral satisfat√≥ria. Manter estrat√©gia atual.");
            }
            
            return recomendacoes;
        }

        // Fun√ß√µes existentes (mantidas)
        function atualizarPainel() {
            const totalClientes = clientes.length;
            const scores = clientes.map(c => calcularScore(c.id));
            const mediaGeral = scores.length > 0 ? (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(2) : 0;
            const excelentes = scores.filter(s => s >= 8.5).length;
            const totalCriterios = criteria.length;

            document.getElementById('total-clientes').textContent = totalClientes;
            document.getElementById('media-geral').textContent = mediaGeral;
            document.getElementById('clientes-excelentes').textContent = excelentes;
            document.getElementById('total-criterios').textContent = totalCriterios;

            const clientesComScore = clientes.map(c => ({
                ...c,
                score: calcularScore(c.id)
            })).sort((a, b) => b.score - a.score);

            const topHTML = clientesComScore.slice(0, 3).map((c, index) => {
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                return `
                    <div class="ranking-item">
                        <div>${medals[index]} ${c.nome}</div>
                        <div style="font-weight: bold;">${c.score}</div>
                    </div>
                `;
            }).join('');
            document.getElementById('top-ranking').innerHTML = topHTML;

            const bottomHTML = clientesComScore.slice(-3).reverse().map(c => `
                <div class="ranking-item">
                    <div>‚ö†Ô∏è ${c.nome}</div>
                    <div style="font-weight: bold;">${c.score}</div>
                </div>
            `).join('');
            document.getElementById('bottom-ranking').innerHTML = bottomHTML;

            const resumoHTML = `
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 15px; text-align: left;">Cliente</th>
                            <th style="padding: 15px; text-align: left;">Score</th>
                            <th style="padding: 15px; text-align: left;">Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${clientesComScore.map(c => {
                            const scoreInfo = getScoreClass(c.score);
                            return `
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 15px; font-weight: 600;">${c.nome}</td>
                                    <td style="padding: 15px; font-size: 1.2rem; font-weight: bold;">${c.score}</td>
                                    <td style="padding: 15px;">
                                        <span class="score-badge ${scoreInfo.class}">${scoreInfo.label}</span>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('resumo-table').innerHTML = resumoHTML;
        }

        function atualizarListaClientes() {
            const html = clientes.map(cliente => {
                const score = calcularScore(cliente.id);
                const scoreInfo = getScoreClass(score);
                
                const criteriosHTML = criteria.map(criterio => criarInputCriterio(criterio, cliente.id)).join('');

                return `
                    <div class="cliente-card">
                        <div class="cliente-header">
                            <div class="cliente-nome">${cliente.nome}</div>
                            <div class="score-badge ${scoreInfo.class}">Score: ${score}</div>
                            <button class="btn btn-danger" onclick="removerCliente('${cliente.id}')">üóëÔ∏è</button>
                        </div>
                        <div class="criterios-grid">
                            ${criteriosHTML}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('lista-clientes').innerHTML = html;
        }

        function atualizarCriterios() {
            const html = criteria.map(criterio => {
                const tipoBadge = getTipoBadge(criterio.tipo);
                return `
                    <tr>
                        <td style="font-weight: 600;">${criterio.nome}</td>
                        <td><span class="badge-tipo ${tipoBadge.class}">${tipoBadge.label}</span></td>
                        <td>
                            <input type="number" value="${criterio.peso}" min="1" max="20" 
                                   style="width: 80px; padding: 5px; border: 1px solid #ddd; border-radius: 5px;"
                                   onchange="alterarPeso('${criterio.id}', this.value)">
                        </td>
                        <td>
                            <button class="btn btn-danger" onclick="removerCriterio('${criterio.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('criterios-table-body').innerHTML = html;
        }

        function adicionarCliente() {
            const nome = document.getElementById('novo-cliente').value.trim();
            if (!nome) return;

            const id = 'c' + Date.now();
            clientes.push({ id, nome });
            document.getElementById('novo-cliente').value = '';
            
            salvarDados();
            atualizarListaClientes();
            atualizarPainel();
            atualizarSeletorMetas();
        }

        function removerCliente(id) {
            if (!confirm('Remover este cliente?')) return;
            clientes = clientes.filter(c => c.id !== id);
            
            Object.keys(registos).forEach(mes => {
                if (registos[mes][id]) delete registos[mes][id];
            });
            
            Object.keys(metas).forEach(ano => {
                if (metas[ano][id]) delete metas[ano][id];
            });
            
            salvarDados();
            atualizarListaClientes();
            atualizarPainel();
            atualizarSeletorMetas();
        }

        function adicionarCriterio() {
            const nome = document.getElementById('novo-criterio-nome').value.trim();
            const tipo = document.getElementById('novo-criterio-tipo').value;
            const peso = parseInt(document.getElementById('novo-criterio-peso').value) || 8;
            
            if (!nome) return;

            const id = nome.toLowerCase().replace(/[^a-z0-9]/g, '_');
            criteria.push({ id, nome, peso, tipo });
            
            document.getElementById('novo-criterio-nome').value = '';
            document.getElementById('novo-criterio-tipo').value = 'escala';
            document.getElementById('novo-criterio-peso').value = '8';
            
            salvarDados();
            atualizarCriterios();
            atualizarListaClientes();
            atualizarPainel();
        }

        function removerCriterio(id) {
            if (!confirm('Remover este crit√©rio?')) return;
            criteria = criteria.filter(c => c.id !== id);
            
            salvarDados();
            atualizarCriterios();
            atualizarListaClientes();
            atualizarPainel();
        }

        function alterarPeso(id, novoPeso) {
            const criterio = criteria.find(c => c.id === id);
            if (criterio) {
                criterio.peso = parseInt(novoPeso) || 1;
                salvarDados();
                atualizarPainel();
            }
        }

        function atualizarRegistro(clienteId, criterioId, campo, valor) {
            const mes = getCurrentMonth();
            
            if (!registos[mes]) registos[mes] = {};
            if (!registos[mes][clienteId]) registos[mes][clienteId] = {};
            if (!registos[mes][clienteId][criterioId]) registos[mes][clienteId][criterioId] = {};
            
            registos[mes][clienteId][criterioId][campo] = valor;
            
            salvarDados();
            atualizarListaClientes();
            atualizarPainel();
        }

        function exportarDados() {
            const dados = { criteria, clientes, registos, metas };
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `scorecard_completo_${getCurrentMonth()}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function importarDados(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    if (dados.criteria && dados.clientes && dados.registos) {
                        criteria = dados.criteria;
                        clientes = dados.clientes;
                        registos = dados.registos;
                        metas = dados.metas || {};
                        salvarDados();
                        atualizarPainel();
                        atualizarListaClientes();
                        atualizarCriterios();
                        alert('Dados importados com sucesso!');
                    } else {
                        alert('Ficheiro inv√°lido!');
                    }
                } catch (error) {
                    alert('Erro ao ler ficheiro!');
                }
            };
            reader.readAsText(file);
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            atualizarPainel();
            atualizarListaClientes();
            atualizarCriterios();
            
            // Definir m√™s atual no seletor
            const mesAtual = getCurrentMonth().split('-')[1];
            document.getElementById('mes-selector').value = mesAtual;
        });

        document.getElementById('novo-cliente').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') adicionarCliente();
        });

        document.getElementById('novo-criterio-nome').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') adicionarCriterio();
        });
    </script>
</body>
</html>
